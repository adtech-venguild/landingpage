<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VENGUILD – Archetype Reveal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0c1116; --card:#0f141a; --line:rgba(255,255,255,.08);
    --text:#e9ecf1; --muted:#a9b4c1; --gold:#ffdf9e; --accent:#37e07d;

    /* Positioning targets copied from loadingpage.html */
    --hero-left-mobile: 40%;  /* used by SHADOW (center-ish) */
    --pro-left-mobile: 60%;   /* used by PRO (slightly right of center) */
    --hero-left-wide: -45%;   /* SHADOW hugs far-left on wide */
    --pro-left-wide:  -12%;   /* PRO sits left-center (a bit right) */
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0}
  body{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: var(--bg); color: var(--text);
    min-height: 100dvh; display:grid; place-items:center; padding:14px;
    background-image: linear-gradient(to bottom, rgba(6,12,18,.55), rgba(6,12,18,.6)), url("assets/background/background1.png");
    background-size:cover; background-position:center;
  }

  /* Stage layout (no outer box/border/shadow) */
  .wrap{
    width:min(1200px,96vw);
    display:grid; gap:22px;
    grid-template-columns: 0.95fr 1.3fr;
    animation:fade .45s ease;
    border:none; box-shadow:none; background:transparent; padding:0;
  }
  @keyframes fade{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none}}

  /* LEFT: shadow + pro, aligned toe-to-toe like loadingpage.html */
  .gallery{
    position:relative;
    min-height:920px;
    overflow:visible;
  }
  .img{
    position:absolute; bottom:0; height:100%; width:auto; object-fit:contain;
    -webkit-user-drag:none; user-select:none;
    filter: drop-shadow(0 14px 28px rgba(0,0,0,.55));
    opacity:0; transform:translate(-50%,6px);
    transition:opacity .6s ease, transform .6s ease;
    pointer-events:none;
  }
  .img.loaded{ opacity:1; transform:translate(-50%,0); }

  /* Mobile defaults */
  .shadow{ left: var(--hero-left-mobile); z-index:6; }
  .pro   { left: var(--pro-left-mobile);  z-index:7; }

  /* Shadow glimmer overlay must match shadow geometry */
  .shadow-shine{
    position:absolute; bottom:0; height:100%;
    /* width set from JS to match the shadow’s rendered width */
    left: var(--hero-left-mobile);
    transform: translate(-50%,0);
    pointer-events:none;
    z-index:6; /* above shadow, below pro */
    mix-blend-mode: screen;
  }

  /* Wide screens — anchor from the left (no translate centering) */
  @media (min-width:1200px){
    .shadow{ left: var(--hero-left-wide); transform:translate(0,0); }
    .shadow.loaded{ transform:none; }
    .pro{ left: var(--pro-left-wide); transform:translate(0,0); }
    .pro.loaded{ transform:none; }

    .shadow-shine{ left: var(--hero-left-wide); transform:none; }
  }

  /* RIGHT: glassy content (kept) */
  .pane{ position:relative; z-index:5; }
  .pane::before{
    content:"";
    position:absolute; inset:-26px; border-radius:24px;
    background:
      radial-gradient(120% 80% at 80% 40%, rgba(111,227,255,.10), transparent 60%),
      radial-gradient(90% 70%  at 20% 70%, rgba(55,224,125,.10),  transparent 65%),
      rgba(10,16,23,.55);
    box-shadow:
      0 0 0 1px rgba(255,255,255,.08),
      0 20px 80px rgba(0,0,0,.55),
      inset 0 0 200px rgba(55,224,125,.10),
      inset 0 0 140px rgba(111,227,255,.08);
    backdrop-filter: blur(6px);
    pointer-events:none;
  }
  .inner{ padding:12px 14px; position:relative; }

  /* Typography & chips (kept) */
  h1{
    font-family:Cinzel,serif; margin:2px 2px 8px;
    font-size: clamp(28px, 4.2vw, 46px);
    color: var(--gold); line-height:1.15;
  }
  .muted{color:var(--muted)}
  .chipsRow{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:8px 2px 6px}
  .chip{
    padding:8px 12px; border-radius:999px; border:1px solid #1b2738; background:#0b1015;
    font-weight:700; color:#cfe6ff; letter-spacing:.02em;
  }
  .rank{
    width:auto; min-width:44px; height:44px; padding:0 12px; display:grid; place-items:center;
    border-radius:10px; border:1px solid #5f80ae; background:#0b1015; color:#cfe6ff;
    font-weight:900; font-size:20px;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px; font-weight:800;
    color:#0c1116; background:linear-gradient(135deg, var(--accent), #2cd18c, #1aa37c);
  }
  .sectionTitle{font-weight:900; letter-spacing:.05em; margin:12px 2px 6px; color:#cfe3ff; text-transform:uppercase; font-size:13px}
  .desc{
    background:#0b1015; border:1px solid #1b2738; border-radius:14px;
    padding:16px; line-height:1.7; margin:8px 2px 0;
    opacity:0; transform:translateY(6px); animation:fadeInUp .45s ease .08s forwards
  }
  @keyframes fadeInUp{ to{opacity:1; transform:none} }
  .chips{display:flex; flex-wrap:wrap; gap:8px; margin:0 2px 8px}
  .chip.active{
    color:#0c1116; border-color:transparent;
    background:linear-gradient(135deg, #ffe27a, #ffd35a, #ffb800);
    box-shadow:0 0 12px rgba(255,216,112,.45), inset 0 0 8px rgba(255,255,255,.25);
  }
  .ranks{display:flex; gap:8px; flex-wrap:wrap; margin:0 2px}
  .rank.active{
    color:#0c1116; background:linear-gradient(135deg,#a0f2ff,#6fe3ff);
    box-shadow:0 0 16px rgba(160,242,255,.5), inset 0 0 10px rgba(255,255,255,.25);
  }

  /* ======= ORBIT ORBS (kept) ======= */
  .eaWrap{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin:6px 2px 0 2px }
  .eaLabel{ font-weight:800; color:#cfe3ff; letter-spacing:.04em; text-transform:uppercase; font-size:12px; }
  .orbDock{ --R:22px; --speed:22s; position: relative; width: calc(var(--R) * 2); height: calc(var(--R) * 2); pointer-events:none; filter: drop-shadow(0 6px 14px rgba(0,0,0,.45)); }
  .orb-track{ position:absolute; inset:0; border-radius:50%; animation:orb-ccw var(--speed) linear infinite; }
  @keyframes orb-ccw{ to{ transform:rotate(-360deg);} }
  .orb-wrap{ position:absolute; top:50%; left:50%; transform: rotate(var(--phase)) translateX(var(--R)) translate(-50%,-50%); }
  .orb{ --size:26; --c:#fff; position:absolute; top:50%; left:50%; width:calc(var(--size)*1px); height:calc(var(--size)*1px); transform:translate(-50%,-50%); border-radius:50%;
        background: radial-gradient(circle at 32% 28%, transparent 0 38%, rgba(0,0,0,.55) 100%), radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--c) 70%, transparent), transparent 60%);
        border:1px solid color-mix(in srgb, var(--c) 60%, transparent 40%); box-shadow:0 0 10px var(--c), 0 0 26px var(--c), 0 0 60px color-mix(in srgb, var(--c) 55%, transparent); }
  .orb::before{ content:""; position:absolute; inset:-14px; border-radius:50%;
    background: radial-gradient(circle, color-mix(in srgb, var(--c) 25%, transparent), transparent 70%); filter:blur(10px); animation:orb-pulse 3.6s ease-in-out infinite; }
  @keyframes orb-pulse{ 0%,100%{opacity:.45; transform:scale(1)} 50%{opacity:.8; transform:scale(1.08)} }
  .sparks{ position:absolute; top:50%; left:50%; width:0; height:0; }
  .spark{
    --col:#fff; --ang:0deg; --dist:18; --ssize:4; --dur:6s; --delay:0s;
    position:absolute; top:0; left:0; width:calc(var(--ssize)*1px); height:calc(var(--ssize)*1px);
    border-radius:50%;
    background: radial-gradient(circle at 40% 40%, #fff 0 40%, var(--col) 55%, transparent 75%);
    box-shadow:0 0 6px var(--col), 0 0 16px color-mix(in srgb, var(--col) 85%, transparent);
    transform:translate(-50%,-50%) rotate(var(--ang)) translateX(calc(var(--dist)*1px));
    animation:spark-swirl var(--dur) linear infinite, spark-twinkle calc(var(--dur)*.8) ease-in-out infinite;
    animation-delay:var(--delay);
  }
  @keyframes spark-swirl{ to{ transform:translate(-50%,-50%) rotate(calc(var(--ang) + 360deg)) translateX(calc(var(--dist)*1px)); } }
  @keyframes spark-twinkle{ 0%,100%{opacity:.2; filter:blur(.5px)} 15%{opacity:.9; filter:blur(.2px)} 55%{opacity:.35; filter:blur(.9px)} }

  /* ====== GLINT bits (kept) ====== */
  .glint-wrap{ position:absolute; inset:-15%; transform:rotate(var(--ang, 0deg)); overflow:hidden; }
  .glint-bar{
    position:absolute; top:0; bottom:0; left:-40%; width:30%;
    background: linear-gradient(to right, rgba(135,180,255,0) 0%, rgba(170,220,255,.45) 40%, rgba(255,255,255,.95) 50%, rgba(170,220,255,.45) 60%, rgba(135,180,255,0) 100%);
    filter: blur(8px) drop-shadow(0 0 6px rgba(170,220,255,.55)) drop-shadow(0 0 16px rgba(155,210,255,.35));
    animation: glint-move 1.35s ease-in-out forwards; opacity:.85;
  }
  @keyframes glint-move{ to{ transform:translateX(220%); opacity:0; } }

  /* ====== CTA: “adventurer” button ====== */
  .cta{
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    margin:22px 2px 4px;
    padding:16px 26px;
    border-radius:999px;
    font-weight:900; letter-spacing:.04em; text-transform:uppercase;
    font-size: clamp(16px, 2.2vw, 20px);
    color:#2a1a00; text-decoration:none; cursor:pointer;
    background:linear-gradient(135deg,#ffe27a,#ffd35a,#ffb800);
    border:1px solid rgba(255,244,198,.65);
    box-shadow:0 12px 22px rgba(0,0,0,.45), 0 0 20px rgba(255,216,112,.55), inset 0 0 10px rgba(255,255,255,.28);
    transition:transform .15s ease, box-shadow .2s ease, filter .2s ease;
  }
  .cta:hover{
    transform:translateY(-2px) scale(1.03);
    box-shadow:0 16px 28px rgba(0,0,0,.55), 0 0 28px rgba(255,216,112,.75), inset 0 0 12px rgba(255,255,255,.35);
    filter:saturate(1.08);
  }

  /* Stack on narrow screens */
  @media (max-width:1080px){
    .wrap{ grid-template-columns:1fr }
    .gallery{ min-height:600px }
  }
  @media (max-width:760px){
    .gallery{ min-height:520px }
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT: Shadow + shimmer (like hero) and Professional (like pro) -->
    <div class="gallery">
      <img id="imgShadow" class="img shadow" alt="Shadow">
      <div id="shadowShine" class="shadow-shine" aria-hidden="true"></div>
      <img id="imgPro" class="img pro" alt="Professional">
    </div>

    <!-- RIGHT: keep the same info (no job result added) -->
    <section class="pane">
      <div class="inner">
        <h1 id="greeting">Congratulations, Adventurer!</h1>

        <div class="row"><div class="pill" id="totalPill">Total Level: —</div></div>

        <div class="eaWrap">
          <div class="eaLabel">Elemental Affinity:</div>
          <h2 id="elemTitle" style="margin:0; font-family:Cinzel,serif;">Loading…</h2>
          <div class="orbDock"><div class="orb-track" id="orbTrack"></div></div>
        </div>
        <p class="muted" id="elemSubtitle"></p>
        <div class="desc" id="elemDesc">—</div>

        <div class="sectionTitle">Guild Title Recommendation:</div>
        <div class="chips" id="levelChips">
          <div class="chip" data-level="Aspirant">Aspirant</div>
          <div class="chip" data-level="Apprentice">Apprentice</div>
          <div class="chip" data-level="Advanced I">Advanced I</div>
          <div class="chip" data-level="Advanced II">Advanced II</div>
          <div class="chip" data-level="Master">Master</div>
        </div>

        <div class="sectionTitle">Guild Rank Recommendation:</div>
        <div class="ranks" id="rankRow">
          <div class="rank" data-r="F">F</div><div class="rank" data-r="E">E</div><div class="rank" data-r="D">D</div>
          <div class="rank" data-r="C">C</div><div class="rank" data-r="B">B</div><div class="rank" data-r="A">A</div>
          <div class="rank" data-r="S">S</div>
        </div>

        <!-- Upgraded adventurer CTA -->
        <a class="cta" href="personalitytest.html" id="ctaBtn">TAKE THE ADVENTURER TEST — FIND YOUR FIT!</a>
      </div>
    </section>
  </div>

<script>
/* ---------- helpers ---------- */
const $ = s => document.querySelector(s);
const safe = x => (x==null ? '' : String(x));
const dedup = arr => [...new Set(arr)];
const sortDigits = s => s.split('').sort().join('');
async function getJSON(path){ try{ const r = await fetch(path,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json(); }catch{ return null; } }

/* fallback elements (kept) */
const ELEMENTS_FALLBACK = [
  {code:"1",name:"Earth",desc:"You are grounded, dependable, and unshakable."},
  {code:"2",name:"Fire",desc:"You burn with passion and ambition."},
  {code:"3",name:"Air",desc:"You are freedom, intelligence, and curiosity."},
  {code:"4",name:"Water",desc:"You are empathy, intuition, and adaptability."},
  {code:"5",name:"Aether",desc:"You are vision, spirituality, and transcendence."},
  {code:"12",name:"Earth + Fire",desc:"Endurance with willpower."},
  {code:"13",name:"Earth + Air",desc:"Practical strategist."},
  {code:"14",name:"Earth + Water",desc:"Healer of growth."},
  {code:"15",name:"Earth + Aether",desc:"Vision anchored in reality."},
  {code:"23",name:"Fire + Air",desc:"Spark of movements."},
  {code:"24",name:"Fire + Water",desc:"Protector with heart."},
  {code:"25",name:"Fire + Aether",desc:"Spiritual flame."},
  {code:"34",name:"Air + Water",desc:"Dreamer with empathy."},
  {code:"35",name:"Air + Aether",desc:"Philosopher in flight."},
  {code:"45",name:"Water + Aether",desc:"Mystic and guide."},
  {code:"123",name:"Earth + Fire + Air",desc:"Builder of civilizations."},
  {code:"124",name:"Earth + Fire + Water",desc:"Shaper of life."},
  {code:"125",name:"Earth + Fire + Aether",desc:"Eternal forge."},
  {code:"134",name:"Earth + Air + Water",desc:"Harmonizer."},
  {code:"135",name:"Earth + Air + Aether",desc:"Sage architect."},
  {code:"145",name:"Earth + Water + Aether",desc:"Guardian of life."},
  {code:"234",name:"Fire + Air + Water",desc:"Revolutionary."},
  {code:"235",name:"Fire + Air + Aether",desc:"Cosmic messenger."},
  {code:"245",name:"Fire + Water + Aether",desc:"Purifier."},
  {code:"345",name:"Air + Water + Aether",desc:"Visionary empath."},
  {code:"1234",name:"Earth + Fire + Air + Water",desc:"Avatar of balance."},
  {code:"1235",name:"Earth + Fire + Air + Aether",desc:"Divine maker."},
  {code:"1245",name:"Earth + Fire + Water + Aether",desc:"Eternal cycle."},
  {code:"1345",name:"Earth + Air + Water + Aether",desc:"Grand sage."},
  {code:"2345",name:"Fire + Air + Water + Aether",desc:"Cosmic transformer."},
  {code:"12345",name:"All Five",desc:"Weavekeeper—the full circle of existence."}
];

/* level & rank (kept) */
function levelTitle(total){ if(total>=100) return 'Master'; if(total>=76) return 'Advanced II'; if(total>=51) return 'Advanced I'; if(total>=26) return 'Apprentice'; return 'Aspirant'; }
function baseRankFor(level){ return level==='Master'?'B':level==='Advanced II'?'C':level==='Advanced I'?'D':level==='Apprentice'?'E':'F'; }
function countVerifications(){ try{ const v=JSON.parse(localStorage.getItem('venguild_verifications')||'{}')||{}; return ['twoIDs','employment','diploma','tor','address','payslip','billing','ecommerce'].reduce((n,k)=>n+(v[k]?1:0),0);}catch{return 0;} }
function finalRankFor(level){ const L=['F','E','D','C','B','A','S']; const b=L.indexOf(baseRankFor(level)); const steps=Math.min(countVerifications(), L.length-1-b); return L[b+steps]; }

/* element colors */
const ORB_COLOR = { '1':'#5b3a1e','2':'#ff6a6a','3':'#4da3ff','4':'#7ef2b0','5':'#37e07d' };

/* ---------- main ---------- */
(async function main(){
  const raw = localStorage.getItem('venguild_complete_profile');
  if (!raw){
    $('#elemTitle').textContent = 'No profile found';
    $('#elemDesc').textContent  = 'Please go back and complete your profile.';
    $('#imgShadow').style.display = 'none';
    $('#imgPro').style.display    = 'none';
    return;
  }
  const payload = JSON.parse(raw);

  const [countries, sectors, programs, elementsFile] = await Promise.all([
    getJSON('data/country_ethnicity.json'),
    getJSON('data/sectors.json'),
    getJSON('data/programs.json'),
    getJSON('data/elements.json')
  ]);

  /* Greeting and totals (kept) */
  $('#greeting').textContent = `Congratulations, ${safe(payload?.name?.first||'Adventurer')}!`;

  /* Gender -> shadow */
  const g = (payload.gender||'').toLowerCase();
  const gCode = (g==='m' || g==='male') ? 'm' : 'f';
  const shadowPath = `assets/default/shadow_${gCode}.png`;

  /* Region for professional */
  let regionCode = '';
  if (Array.isArray(countries)){
    const c = countries.find(x => safe(x.Country||x.country||x.name).toLowerCase() === safe(payload.citizenship).toLowerCase());
    if (c){ const rc=safe(c.code||c.Code||c.region||''); regionCode = rc.startsWith('_') ? rc.slice(1) : rc; }
  }
  const top = (payload.experience||[]).slice().sort((a,b)=> (b.computedLevel||0) - (a.computedLevel||0))[0];

  /* Sector -> element (kept) */
  const sectorCodeToElem = new Map((sectors||[]).map(s=>[ String(s.Code||s.code||'').trim(), Number(s.ElementCode||s.elementCode||0) ]));
  const expElems = (payload.experience||[]).map(x=> sectorCodeToElem.get(String(x.code||'').trim()) || 0);
  const eduElems = (payload.education||[]).map(e=>{
    const p = (programs||[]).find(q => String(q.Program||q.title||'').trim().toLowerCase() === String(e.program||'').trim().toLowerCase());
    return Number(p?.ElementCode||p?.elementCode||0);
  });
  const comboKey = sortDigits(dedup([...expElems, ...eduElems].filter(Boolean).map(String)).join(''));
  const combo = (()=> {
    if (Array.isArray(elementsFile)){
      for (const it of elementsFile){
        const code = sortDigits(String(it.Code||it.code||'')); if (code && code===comboKey)
          return {name: it.Combination||it.name||it.title||`Combo ${code}`, desc: it.Description||it.description||'—'};
      }
    }
    return ELEMENTS_FALLBACK.find(e => sortDigits(e.code)===comboKey) || {name:'Elemental Profile', desc:'Your selections did not match a defined combination yet.'};
  })();

  const expTotal = (payload.experience||[]).reduce((s,x)=> s + Number(x.computedLevel || (x.years||0)*(x.multiplier||0)), 0);
  const eduTotal = (payload.education||[]).reduce((s,x)=> s + Number(x.multiplier||0), 0);
  const totalLevel = expTotal + eduTotal;
  const lvlTitle = levelTitle(totalLevel);
  const rankFinal = finalRankFor(lvlTitle);

  /* Paint right panel (kept) */
  const shadowEl = $('#imgShadow');
  shadowEl.onload = ()=> shadowEl.classList.add('loaded');
  shadowEl.src = shadowPath;

  const proEl = $('#imgPro');
  if (top?.code && regionCode){
    proEl.onload = ()=> proEl.classList.add('loaded');
    proEl.src = `assets/professional/${String(top.code).trim()}_${gCode}_${regionCode}.png`;
  } else {
    proEl.style.display='none';
  }

  $('#elemTitle').textContent = combo.name;
  $('#elemDesc').textContent  = combo.desc;
  $('#totalPill').textContent = `Total Level: ${totalLevel}`;
  for (const c of document.querySelectorAll('#levelChips .chip')) c.classList.toggle('active', c.dataset.level===lvlTitle);
  for (const r of document.querySelectorAll('#rankRow .rank'))   r.classList.toggle('active', r.dataset.r===rankFinal);

  /* Build ORBS (kept) */
  const digits = (comboKey||'').split('').filter(d => ORB_COLOR[d]);
  const track = $('#orbTrack');
  if (!digits.length){ track.parentElement.style.display='none'; }
  else{
    const R = 22, spacing = 22;
    track.style.setProperty('--speed', (digits.length===1?'18s':digits.length===2?'20s':'22s'));
    track.innerHTML = '';
    digits.forEach((d,i)=>{
      const wrap = document.createElement('div');
      wrap.className = 'orb-wrap';
      wrap.style.setProperty('--phase', (i*spacing)+'deg');
      wrap.style.setProperty('--R', R+'px');

      const orb = document.createElement('div');
      orb.className = 'orb';
      orb.style.setProperty('--c', ORB_COLOR[d]);
      orb.style.setProperty('--size', ({'1':28,'2':27,'3':26,'4':26,'5':25}[d]||26));

      const sparks = document.createElement('div');
      sparks.className = 'sparks';

      wrap.appendChild(orb);
      wrap.appendChild(sparks);
      track.appendChild(wrap);

      const rnd = (a,b)=> a + Math.random()*(b-a);
      const size = parseFloat(getComputedStyle(orb).getPropertyValue('--size')) || 26;
      const COUNT = 20, minR = size*0.7, maxR = size*1.9;
      for (let s=0;s<COUNT;s++){
        const iEl = document.createElement('i');
        iEl.className = 'spark';
        iEl.style.setProperty('--col', ORB_COLOR[d]);
        iEl.style.setProperty('--ang',  rnd(0,360).toFixed(2)+'deg');
        iEl.style.setProperty('--dist', rnd(minR,maxR).toFixed(1));
        iEl.style.setProperty('--ssize',rnd(2,5).toFixed(1));
        iEl.style.setProperty('--dur',  rnd(4.5,9).toFixed(2)+'s');
        iEl.style.setProperty('--delay',(-rnd(0,8)).toFixed(2)+'s');
        sparks.appendChild(iEl);
      }
    });
  }

  /* ====== SHADOW GLIMMER: mask to the shadow, match size/position ====== */
  const shineEl = document.getElementById('shadowShine');

  function sizeShineToShadow(){
    if (!shadowEl.naturalWidth || !shadowEl.naturalHeight) return;
    const gH = shadowEl.parentElement.clientHeight;              // gallery height
    const ratio = shadowEl.naturalWidth / shadowEl.naturalHeight; // w/h
    const w = Math.round(gH * ratio);
    shineEl.style.width = w + 'px';
    shineEl.style.height = '100%';

    // Use the shadow silhouette as a mask so the glint stays inside it
    const url = shadowEl.getAttribute('src');
    shineEl.style.webkitMaskImage = `url('${url}')`;
    shineEl.style.maskImage = `url('${url}')`;
    shineEl.style.webkitMaskRepeat = shineEl.style.maskRepeat = 'no-repeat';
    shineEl.style.webkitMaskSize = shineEl.style.maskSize = '100% 100%';  // exact fit to box
    shineEl.style.webkitMaskPosition = shineEl.style.maskPosition = 'center bottom';
  }

  function sparkle(){
    const ang = (Math.random()*110 - 55).toFixed(1) + 'deg';
    const wrap = document.createElement('div');
    wrap.className = 'glint-wrap';
    wrap.style.setProperty('--ang', ang);
    const bar = document.createElement('div');
    bar.className = 'glint-bar';
    wrap.appendChild(bar);
    shineEl.appendChild(wrap);
    bar.addEventListener('animationend', ()=> wrap.remove(), {once:true});
  }

  function startShimmer(){
    sizeShineToShadow();
    setTimeout(sparkle, 800);
    setInterval(sparkle, 10000);
  }

  if (shadowEl.complete){ startShimmer(); } else { shadowEl.addEventListener('load', startShimmer); }
  window.addEventListener('resize', sizeShineToShadow);
})();
</script>
</body>
</html>
